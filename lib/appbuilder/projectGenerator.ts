import { generateBlueprint } from "./blueprint";

type Blueprint = {
  name?: string;
  description?: string;
};

export async function generateProjectFiles(prompt: string) {
  const blueprint = (await generateBlueprint(prompt)) as Blueprint;

  const safeName =
    (blueprint.name || "iblacker-app")
      .toLowerCase()
      .replace(/[^a-z0-9-]+/g, "-")
      .replace(/-+/g, "-")
      .replace(/^-|-$/g, "") || "iblacker-app";

  const packageJson = {
    name: safeName,
    version: "0.1.0",
    private: true,
    scripts: {
      dev: "next dev",
      build: "next build",
      start: "next start",
    },
    dependencies: {
      next: "latest",
      react: "latest",
      "react-dom": "latest",
    },
  };

  const indexPage = `export default function Home() {
  return (
    <main style={{ padding: 40, fontFamily: "system-ui" }}>
      <h1>${blueprint.name || "IBlacker App"}</h1>
      <p>${blueprint.description || "Generated by IBlacker App Builder."}</p>
    </main>
  );
}
`;

  return {
    blueprint,
    files: {
      "package.json": JSON.stringify(packageJson, null, 2),
      "app/page.tsx": indexPage,
    },
  };
}